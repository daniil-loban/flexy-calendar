<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style type="text/css">
      .calendar{
        position: relative;
      }
      .calendar__input {
        position: relative;
        cursor: pointer;
        width: 100%;
      }
      .calendar__input input {
        cursor: pointer;
         width: 100%;
      }
      .calendar__input input._form-focus {
        border: 1px solid #ebebeb;
      }
      .calendar__input.showCal input {
        border: 1px solid green;
      }
      .calendar__input.showCal::before {
        color: green;
      }
      .calendar__input::before {
        position: absolute;
        right: 20px;
        font-size: 20px;
        color: #afafaf;
        top: 50%;
        transform: translate(0, -50%);
        pointer-events: none;
      }
      .calendar__content {
        position: absolute;
        z-index: 40;
        right: 0;
        padding: 25px;
        top: 99%;
        width: auto;
        background: #f8f8f8;
        border: 1px solid green;
        border-radius: 2px;
      }
      .calendar__header {
        display: flex;
        align-items: center;
        font-weight: 400;
        font-size: 16px;
        margin: 0px 0px 24px 0px;
      }
      .calendar__header span {
        flex: 1 1 auto;
      }
      .calendar__btn-prev {
        width: 24px;
        height: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0px 27px 0px 0px;
      }
      .calendar__btn-prev::before {
        font-size: 16px;
        transform: rotate(-90deg);
      }
      .calendar__btn-prev:hover::before {
        color: green;
      }
      .calendar__btn-next {
        width: 24px;
        height: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .calendar__btn-next::before {
        font-size: 16px;
        transform: rotate(90deg);
      }
      .calendar__btn-next:hover::before {
        color: green;
      }
      .calendar__days {
        display: grid;
        column-gap: 35px;
        grid-template-columns: repeat(7, 1fr);
        margin: 0px 0px 16px 0px;
      }
      .calendar__main {
        display: grid;
        column-gap: 35px;
        row-gap: 16px;
        grid-template-columns: repeat(7, 1fr);
        grid-template-rows: repeat(5, min(32px));
      }

      .cal_date .cell_item {
        cursor: pointer;
        min-width: 32px;
        min-height: 32px;
      }

      .cell_wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .cell_wrapper .cell_item {
        display: flex;
        justify-content: center;
        align-items: center;
        min-width: 32px;
        position: relative;
        font-weight: 400;
        font-size: 16px;
        border-radius: 50%;
        color: rgba(49, 49, 49, 0.5);
      }
      .cell_wrapper.active .cell_item {
        background: #efa021;
        color: #ffffff;
      }

      .current .cell_item {
        color: #111111;
      }

      .hidden {
        visibility: hidden;
      }      
    </style>
  </head>
  <body>
    <div class="tabs-transmit-readings__calendar calendar">
      <div class="calendar__input  _icon-calendar">
        <input autocomplete="off" type="text" id="date" class="onFocus" readonly>
      </div>
      <div class="calendar__content hidden">
        <div class="calendar__header">
          <span></span>
          <button class="calendar__btn-prev calendar-btn _icon-arrow-slider"></button>
          <button class="calendar__btn-next calendar-btn _icon-arrow-slider"></button>
        </div>
        <div class="calendar__wrapper">
          <div class="calendar__days"></div>
          <div class="calendar__main"></div>
        </div>
      </div>
    </div>    
    <script type="text/javascript">
      const calendar = document.querySelector(".calendar__main");
      const input = document.querySelector("#date");
      const calHeader = document.querySelector(".calendar__header");
      const calHeaderTitle = document.querySelector(".calendar__header span");
      const calDays = document.querySelector(".calendar__days");
      const days = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"];
      const months = ["Январь", "Февраль", "Март", "Апрель",
        "Май", "Июнь", "Июль", "Август",
        "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
      const MAX_MONTH_LEN = 31
      let oneDayMs = 86400000;
      let todayTimestampMs = Date.now() - (Date.now() % oneDayMs) +
          new Date().getTimezoneOffset() * 60000;
      let selectedDay = todayTimestampMs;
      let date = new Date();
      let year = date.getFullYear();
      let month = date.getMonth();
      let monthDetails = getMonthDetails(year, month);
      const state = {
        selected: {
          date: date.getDate(), 
          month,
          year,
          cell: null
        },
        current:{
          month,
          year,
        }
      } 

      function updateState(cell){
        state.selected.month = state.current.month
        state.selected.year = state.current.year
        state.selected.date = +cell.innerText
        state.selected.cell = cell
      }

      function getNumberOfDays(year, month){
        return (MAX_MONTH_LEN + 1) - new Date(year, month, (MAX_MONTH_LEN + 1)).getDate();
      };

      function getDayDetails(args){
        let date = args.index - args.firstDay;
        let day = args.index % 7;
        let prevMonth = args.month - 1;
        let prevYear = args.year;
        if (prevMonth < 0) {
          prevMonth = 11;
          prevYear--;
        }
        let prevMonthNumberOfDays = getNumberOfDays(prevYear, prevMonth);
        let _date = (date < 0 ? prevMonthNumberOfDays + date : date % args.numberOfDays) + 1;
        let month = date < 0 ? -1 : date >= args.numberOfDays ? 1 : 0;
        let timestamp = new Date(args.year, args.month, _date).getTime();
        return {
          date: _date,
          day,
          month,
          timestamp,
          dayString: days[day]
        };
      };

      function getMonthDetails(year, month){
        let firstDay = new Date(year, month).getDay();
        let numberOfDays = getNumberOfDays(year, month);
        let monthArray = [];
        let rows = 6;
        let currentDay = null;
        let index = 0;
        let cols = 7;
        for (let row = 0; row < rows; row++) {
          for (let col = 0; col < cols; col++) {
            currentDay = getDayDetails({
                index,
                numberOfDays,
                firstDay,
                year,
                month
            });
            monthArray.push(currentDay);
            index++;
          }
        }
        return monthArray;
      };

      function getMonthStr (month){
        return months[Math.max(Math.min(11, month), 0)] || "Month";
      }

      function setHeaderNav(offset){
        month = month + offset;
        if (month === -1) {
          month = 11;
          year--;
        } else if (month === 12) {
          month = 0;
          year++;
        }
        monthDetails = getMonthDetails(year, month);
        return {
          year,
          month,
          monthDetails
        };
      };

      function setHeader(year, month){
        calHeaderTitle.innerHTML = getMonthStr(month) + " " + year;
      };

      function getDateStringFromTimestamp(timestamp){
        let dateObject = new Date(timestamp);
        let month = dateObject.getMonth();
        let date = dateObject.getDate();
        return `${getMonthStr(month)} ${date}, ${dateObject.getFullYear()}`;
      };

      function setDateToInput(timestamp){
        let dateString = getDateStringFromTimestamp(timestamp);
        input.value = dateString;
      };

      function setCalBody(monthDetails){
        for (let i = 0; i < monthDetails.length; i++) {
          const div = calendar.children[i]
          const span = div.children[0]
          const action = monthDetails[i].month === 0 ? 'add' : 'remove'
          div.classList[action]("current");
          span.innerText = monthDetails[i].date;
        }
        showSelectedCellIfNeed()
      };

      function updateCalendar(btn){
        let newCal, offset;
        if (btn.classList.contains("calendar__btn-prev")) {
            offset = -1;
        } else if (btn.classList.contains("calendar__btn-next")) {
            offset = 1;
        }
        newCal = setHeaderNav(offset);
        setHeader(newCal.year, newCal.month);
        state.current.month = newCal.month
        state.current.year = newCal.year
        setCalBody(newCal.monthDetails);
      };

      function selectOnClick(cell){
        if (!cell) return
        updateState(cell)
        const isActive = cell.classList.contains('active')
        const index = Array.from(calendar.children).findIndex((el) => el === cell) 
        const dayOfWeek = `${index % 7}`
        Object.entries({
          '4': '_active-wek-fifth',
          '5': '_active-wek-sixth',
          '6': '_active-wek-seventh'
          }).forEach(([k, v]) => {
            const test = isActive && dayOfWeek === k
            const action = test ? 'add' : 'remove'
            document.documentElement.classList[action](v)
          })
      };

      function removeActive(){
        document.querySelector('.cal_date.active')?.classList.remove('active')
      }

      function setActive(cell){
        cell?.classList.add('active')
      }

      function addListenerToCalendar(){
        calendar.addEventListener('click', ({target}) => {
          removeActive()
          const cell = target.closest('.cal_date')
          setActive(cell)
          selectOnClick(cell);
        }) 
      }

      function setDaysPlaceholders(monthDetails){
        for (let i = 0; i < monthDetails.length; i++) {
          let div = document.createElement("div"),
              span = document.createElement("span");
          div.classList.add("cell_wrapper");
          div.classList.add("cal_date");
          
          if(monthDetails[i].month === 0){
            div.classList.add("current");
            if (monthDetails[i].timestamp === todayTimestampMs) {
              setActive(div)
              state.selected.cell = div
            }  
          }
          
          span.classList.add("cell_item");
          span.innerText = monthDetails[i].date;
          div.appendChild(span);
          calendar.appendChild(div);
        }
      };

      function showSelectedCellIfNeed(){
        const action = (
          state.selected.month === state.current.month
          && state.selected.year === state.current.year
        ) ? 'add' : 'remove'
        state.selected.cell.classList[action]('active')
      }

      function init(){
        setHeader(year, month);
        setDateToInput(todayTimestampMs);
        setDaysPlaceholders(monthDetails)
        addListenerToCalendar()

        for (let i = 0; i < days.length; i++) {
          let div = document.createElement("div"),
              span = document.createElement("span");
          div.classList.add("cell_wrapper");
          span.classList.add("cell_item");
          span.innerText = days[i].slice(0, 2);
          div.appendChild(span);
          calDays.appendChild(div);
        }

        document.querySelectorAll(".calendar-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            updateCalendar(btn);
          });
        });

        input.addEventListener('click', () => {
          document.querySelector('.calendar__content').classList.toggle('hidden');
          document.querySelector('.calendar__input').classList.toggle('showCal');
          document.querySelector('#date').classList.toggle('onFocus');
        });

        window.addEventListener('click', e => {
          const target = e.target
          if (!target.closest('#date') && !target.closest('.calendar__input') && !target.closest('.calendar__content')) {
            document.querySelector('.calendar__content').classList.add('hidden');
            document.querySelector('.calendar__input').classList.remove('showCal');
            document.querySelector('#date').classList.add('onFocus');
          }
        })
      }
      init()
    </script>
  </body>
</html>